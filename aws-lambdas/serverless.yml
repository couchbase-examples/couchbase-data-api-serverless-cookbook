service: couchbase-airport-api

frameworkVersion: '3'
useDotenv: true

provider:
  name: aws
  runtime: nodejs18.x
  region: ${opt:region, env:AWS_REGION, 'ap-south-1'}
  stage: ${opt:stage, 'dev'}
  environment:    
    DATA_API_ENDPOINT: ${env:DATA_API_ENDPOINT}
    DATA_API_PASSWORD: ${env:DATA_API_PASSWORD}
    DATA_API_USERNAME: ${env:DATA_API_USERNAME}
  httpApi:
    cors: false

package:
  individually: true
  patterns:
    - '!tests/**'
    - '!scripts/**'
    - '!*.test.*'
    - '!*.spec.*'
    - '!README.md'
    - '!.env*'
    - '!.git*'
    - '!.serverlessignore'
    - '!package-lock.json'

functions:
  # CRUD Operations
  getAirport:
    handler: src/getAirport.handler
    package:
      patterns:
        - 'src/getAirport.mjs'
        - '!src/createAirport.mjs'
        - '!src/updateAirport.mjs'
        - '!src/deleteAirport.mjs'
        - '!src/getAirportRoutes.mjs'
        - '!src/getAirportAirlines.mjs'
        - '!src/getHotelsNearAirport.mjs'
    events:
      - httpApi:
          path: /airports/{airportId}
          method: get

  createAirport:
    handler: src/createAirport.handler
    package:
      patterns:
        - 'src/createAirport.mjs'
        - '!src/getAirport.mjs'
        - '!src/updateAirport.mjs'
        - '!src/deleteAirport.mjs'
        - '!src/getAirportRoutes.mjs'
        - '!src/getAirportAirlines.mjs'
        - '!src/getHotelsNearAirport.mjs'
    events:
      - httpApi:
          path: /airports/{airportId}
          method: post

  updateAirport:
    handler: src/updateAirport.handler
    package:
      patterns:
        - 'src/updateAirport.mjs'
        - '!src/getAirport.mjs'
        - '!src/createAirport.mjs'
        - '!src/deleteAirport.mjs'
        - '!src/getAirportRoutes.mjs'
        - '!src/getAirportAirlines.mjs'
        - '!src/getHotelsNearAirport.mjs'
    events:
      - httpApi:
          path: /airports/{airportId}
          method: put

  deleteAirport:
    handler: src/deleteAirport.handler
    package:
      patterns:
        - 'src/deleteAirport.mjs'
        - '!src/getAirport.mjs'
        - '!src/createAirport.mjs'
        - '!src/updateAirport.mjs'
        - '!src/getAirportRoutes.mjs'
        - '!src/getAirportAirlines.mjs'
        - '!src/getHotelsNearAirport.mjs'
    events:
      - httpApi:
          path: /airports/{airportId}
          method: delete

  # Query Operations
  getAirportRoutes:
    handler: src/getAirportRoutes.handler
    package:
      patterns:
        - 'src/getAirportRoutes.mjs'
        - '!src/getAirport.mjs'
        - '!src/createAirport.mjs'
        - '!src/updateAirport.mjs'
        - '!src/deleteAirport.mjs'
        - '!src/getAirportAirlines.mjs'
        - '!src/getHotelsNearAirport.mjs'
    events:
      - httpApi:
          path: /airports/{airportCode}/routes
          method: get

  getAirportAirlines:
    handler: src/getAirportAirlines.handler
    package:
      patterns:
        - 'src/getAirportAirlines.mjs'
        - '!src/getAirport.mjs'
        - '!src/createAirport.mjs'
        - '!src/updateAirport.mjs'
        - '!src/deleteAirport.mjs'
        - '!src/getAirportRoutes.mjs'
        - '!src/getHotelsNearAirport.mjs'
    events:
      - httpApi:
          path: /airports/{airportCode}/airlines
          method: get

  # FTS Operations
  getHotelsNearAirport:
    handler: src/getHotelsNearAirport.handler
    package:
      patterns:
        - 'src/getHotelsNearAirport.mjs'
        - '!src/getAirport.mjs'
        - '!src/createAirport.mjs'
        - '!src/updateAirport.mjs'
        - '!src/deleteAirport.mjs'
        - '!src/getAirportRoutes.mjs'
        - '!src/getAirportAirlines.mjs'
    events:
      - httpApi:
          path: /airports/{airportId}/hotels/nearby/{distance}
          method: get

plugins:
  - serverless-offline

custom:
  serverless-offline:
    httpPort: 3005